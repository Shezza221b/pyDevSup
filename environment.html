

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Runtime Environment &mdash; pyDevSup 0.2-dev documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.2-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="pyDevSup 0.2-dev documentation" href="index.html" />
    <link rel="next" title="devsup Package" href="devsup.html" />
    <link rel="prev" title="Getting Started" href="gettingstarted.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="devsup.html" title="devsup Package"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="gettingstarted.html" title="Getting Started"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">pyDevSup 0.2-dev documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="runtime-environment">
<h1>Runtime Environment<a class="headerlink" href="#runtime-environment" title="Permalink to this headline">¶</a></h1>
<p>The pyDevSup module initializes the interpreter during the registration
phase of IOC startup with the <em>pySetupReg</em> registrar function.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!../../bin/linux-x86_64/softIocPy2.7</span>
<span class="c"># Interpreter not started</span>
<span class="n">dbLoadDatabase</span><span class="p">(</span><span class="s">&quot;../../dbd/softIocPy.dbd&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">softIocPy_registerRecordDeviceDriver</span><span class="p">(</span><span class="n">pdbbase</span><span class="p">)</span>
<span class="c"># Interpreter started</span>
</pre></div>
</div>
<p>An <em>epicsAtExit</em> cleanup handler is also registered at this time.</p>
<p>Several IOC Shell functions are also registered.
<em>py()</em> executes a line of python code.
<em>pyfile()</em> reads and interprets a python script.</p>
<div class="highlight-python"><pre>py("import mymod;)
py("mymod.makeDev('one')")
py("mymod.makeDev('two')")

pyfile("myinit.py")</pre>
</div>
<div class="section" id="pythonpath">
<h2>PYTHONPATH<a class="headerlink" href="#pythonpath" title="Permalink to this headline">¶</a></h2>
<p>The interpreter search path is automatically prefixed with the following additional paths:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">${PWD}</span></tt></li>
<li><tt class="docutils literal"><span class="pre">$(TOP)/python&lt;PY_VER&gt;/$(EPICS_ARCH)</span></tt></li>
<li><tt class="docutils literal"><span class="pre">$(PYDEV_BASE)/python&lt;PY_VER&gt;/$(EPICS_ARCH)</span></tt></li>
<li><tt class="docutils literal"><span class="pre">$(EPICS_BASE)/python&lt;PY_VER&gt;/$(EPICS_ARCH)</span></tt></li>
</ul>
<p>The environment variables <tt class="docutils literal"><span class="pre">EPICS_BASE</span></tt>, <tt class="docutils literal"><span class="pre">PYDEV_BASE</span></tt>, <tt class="docutils literal"><span class="pre">TOP</span></tt>, and <tt class="docutils literal"><span class="pre">EPICS_ARCH</span></tt>
will be used if set.  Compile time defaults are selected for
<tt class="docutils literal"><span class="pre">EPICS_BASE</span></tt>, <tt class="docutils literal"><span class="pre">PYDEV_BASE</span></tt>, <tt class="docutils literal"><span class="pre">EPICS_ARCH</span></tt>.
If <tt class="docutils literal"><span class="pre">TOP</span></tt> is not set then the this entry is omitted.</p>
<p>The default for <tt class="docutils literal"><span class="pre">PYDEV_BASE</span></tt> is the <tt class="docutils literal"><span class="pre">$(INSTALL_LOCATION)</span></tt> given when the
pyDevSup module was built.</p>
</div>
</div>
<div class="section" id="build-environment">
<h1>Build Environment<a class="headerlink" href="#build-environment" title="Permalink to this headline">¶</a></h1>
<p>When building IOCs or installing files, include <tt class="docutils literal"><span class="pre">PYDEVSUP</span></tt> in your <em>configure/RELEASE</em>
file.</p>
<div class="highlight-python"><pre>PYDEVSUP=/dir/where/pyDevSup/is/installed
EPICS_BASE=/....</pre>
</div>
<p>The default or preferred Python version can be specificed in <em>configure/CONFIG_SITE</em></p>
<div class="highlight-python"><pre>PY_VER ?= 2.7</pre>
</div>
<p>The following should be added to individual EPICS Makefiles.</p>
<div class="highlight-python"><pre>TOP=../..
include $(TOP)/configure/CONFIG
include $(PYDEVSUP)/configure/CONFIG_PY
...
include $(TOP)/configure/RULES
include $(PYDEVSUP)/configure/RULES_PY</pre>
</div>
<p>This will add or amend several make variables.  The <tt class="docutils literal"><span class="pre">USR_*FLAGS</span></tt> variables
may be extended with appropriate flags for building python modules.  The <tt class="docutils literal"><span class="pre">PY_VER</span></tt>
variable is defined with the Python version number found in install directories (eg &#8220;2.7&#8221;).
The <tt class="docutils literal"><span class="pre">PY_LD_VER</span></tt> variable is defined with the python library version number (eg &#8220;3.2mu&#8221;),
which may be the same as <tt class="docutils literal"><span class="pre">PY_VER</span></tt>.</p>
<div class="section" id="include-pydevsup-in-your-ioc">
<h2>Include pyDevSup in your IOC<a class="headerlink" href="#include-pydevsup-in-your-ioc" title="Permalink to this headline">¶</a></h2>
<p>While the <em>softIocPyX.Y</em> executable(s) built as part of this module
will be sufficient for many uses, it is also possible to
include the pyDevSup modules in an IOC along with other drivers.
This can be done in the usual way.</p>
<div class="highlight-python"><pre>PROD_IOC = myioc
DBD += myioc.dbd
...
myioc_DBD += pyDevSup.dbd
...
myioc_LIBS += pyDevSup$(PY_LD_VER)</pre>
</div>
</div>
<div class="section" id="installing-py-files">
<h2>Installing .py files<a class="headerlink" href="#installing-py-files" title="Permalink to this headline">¶</a></h2>
<p>Additional .py files can be installed as follows.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">PY</span> <span class="o">+=</span> <span class="n">mymod</span><span class="o">/</span><span class="n">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="n">PY</span> <span class="o">+=</span> <span class="n">mymod</span><span class="o">/</span><span class="n">file1</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
<div class="section" id="building-extensions">
<h2>Building extensions<a class="headerlink" href="#building-extensions" title="Permalink to this headline">¶</a></h2>
<p>For convenience, additional Python extensions can be build by the EPICS
build system.  In this example the extension name is &#8220;_myextname&#8221; and
the resulting library is expected to provide the an initialization function
named &#8220;init_myextname&#8221;.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">LOADABLE_LIBRARY_HOST</span> <span class="o">=</span> <span class="n">_myextname</span>

<span class="n">_myextname_SRCS</span> <span class="o">+=</span> <span class="n">somefile</span><span class="o">.</span><span class="n">c</span>
</pre></div>
</div>
<p>In somefile.c</p>
<div class="highlight-python"><pre>PyMODINIT_FUNC init_myextname(void)</pre>
</div>
</div>
<div class="section" id="installing-for-several-python-versions">
<h2>Installing for several Python versions<a class="headerlink" href="#installing-for-several-python-versions" title="Permalink to this headline">¶</a></h2>
<p>The recipe for building and installing the pyDevSup module
for several python version side by side is</p>
<div class="highlight-python"><pre>make PY_VER=2.6
make clean
make PY_VER=2.7
make clean
make PY_VER=3.2
make clean</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">PYTHON</span></tt> make variable can be specified if the interpreter executable
has a name other than <tt class="docutils literal"><span class="pre">python$(PY_VER)</span></tt>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Runtime Environment</a><ul>
<li><a class="reference internal" href="#pythonpath">PYTHONPATH</a></li>
</ul>
</li>
<li><a class="reference internal" href="#build-environment">Build Environment</a><ul>
<li><a class="reference internal" href="#include-pydevsup-in-your-ioc">Include pyDevSup in your IOC</a></li>
<li><a class="reference internal" href="#installing-py-files">Installing .py files</a></li>
<li><a class="reference internal" href="#building-extensions">Building extensions</a></li>
<li><a class="reference internal" href="#installing-for-several-python-versions">Installing for several Python versions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="gettingstarted.html"
                        title="previous chapter">Getting Started</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="devsup.html"
                        title="next chapter">devsup Package</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/environment.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="devsup.html" title="devsup Package"
             >next</a> |</li>
        <li class="right" >
          <a href="gettingstarted.html" title="Getting Started"
             >previous</a> |</li>
        <li><a href="index.html">pyDevSup 0.2-dev documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Michael Davidsaver.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>